<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="jquery-3.6.1.min.js"></script>
    <script src="helper.js"></script>
    <link rel="stylesheet" href="Kalkulator.css">
</head>

<body>
    <div class="contents">
        <h1 class="header">Calculator</h1>
        <div class="input-area">
            <input type="text" class="Calc" id="" cols="30" rows="5"></input>
            <p class="result">0</p>
        </div>
        <div class="tombol-area">
            <div class="tombol-operator">
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombolPlus">+</a>
                    <a href="#" class="tombol" id="tombolKali">*</a>
                    <a href="#" class="tombol" id="tombolS">Sin</a>
                </div>
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombolMin">-</a>
                    <a href="#" class="tombol" id="tombolBagi">/</a>
                    <a href="#" class="tombol" id="tombolC">Cos</a>
                </div>
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombolBukaKurung">(</a>
                    <a href="#" class="tombol" id="tombolTutupKurung">)</a>
                    <a href="#" class="tombol" id="tombolT">Tan</a>
                </div>
            </div>
            <div class="tombol-angka">
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombol1">1</a>
                    <a href="#" class="tombol" id="tombol4">4</a>
                    <a href="#" class="tombol" id="tombol7">7</a>
                    <a href="#" class="tombol" id="tombolReset">C</a>
                </div>
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombol2">2</a>
                    <a href="#" class="tombol" id="tombol5">5</a>
                    <a href="#" class="tombol" id="tombol8">8</a>
                    <a href="#" class="tombol" id="tombol0">0</a>
                </div>
                <div style="width: 100%;">
                    <a href="#" class="tombol" id="tombol3">3</a>
                    <a href="#" class="tombol" id="tombol6">6</a>
                    <a href="#" class="tombol" id="tombol9">9</a>
                    <a href="#" class="tombol" id="tombolDelete">Del</a>
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    $(document).ready(() => {
        Log('Doocument Ready');
        $('.Calc').css('font-size', '50px')

        tombolListener()
        $(".tombol").click(function () {
            valueChanged()
        });
        $('.Calc').keyup(() => {
            valueChanged()
        })
    })
    function valueChanged() {
        let CalcString = $('.Calc').val()
        // Log(CalcString)
        if (CalcString.length >= 24) {
            let size = 50 - CalcString.length * 0.5
            $('.Calc').css('font-size', `${size}px`)
        }
        else
            $('.Calc').css('font-size', '50px')
        $(".result").text(` ${Calculating(CalcString)}`)
    }
    function tombolListener() {
        $('#tombol1').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol1').text()
            $('.Calc').val(newVal)
        })
        $('#tombol2').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol2').text()
            $('.Calc').val(newVal)
        })
        $('#tombol3').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol3').text()
            $('.Calc').val(newVal)
        })
        $('#tombol4').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol4').text()
            $('.Calc').val(newVal)
        })
        $('#tombol5').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol5').text()
            $('.Calc').val(newVal)
        })
        $('#tombol6').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol6').text()
            $('.Calc').val(newVal)
        })
        $('#tombol7').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol7').text()
            $('.Calc').val(newVal)
        })
        $('#tombol8').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol8').text()
            $('.Calc').val(newVal)
        })
        $('#tombol9').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol9').text()
            $('.Calc').val(newVal)
        })
        $('#tombol0').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombol0').text()
            $('.Calc').val(newVal)
        })
        $('#tombolPlus').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolPlus').text()
            $('.Calc').val(newVal)
        })
        $('#tombolMin').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolMin').text()
            $('.Calc').val(newVal)
        })
        $('#tombolKali').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolKali').text()
            $('.Calc').val(newVal)
        })
        $('#tombolBagi').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolBagi').text()
            $('.Calc').val(newVal)
        })
        $('#tombolBukaKurung').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolBukaKurung').text()
            $('.Calc').val(newVal)
        })
        $('#tombolTutupKurung').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolTutupKurung').text()
            $('.Calc').val(newVal)
        })
        $('#tombolS').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolS').text() + "("
            $('.Calc').val(newVal)
        })
        $('#tombolC').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolC').text() + "("
            $('.Calc').val(newVal)
        })
        $('#tombolT').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal + $('#tombolT').text() + "("
            $('.Calc').val(newVal)
        })
        $('#tombolDelete').click(() => {
            let latesVal = $('.Calc').val()
            newVal = latesVal.slice(0, -1)
            $('.Calc').val(newVal)
        })
        $('#tombolReset').click(() => {
            $('.Calc').val('')
        })
    }

    function Calculating(text) {
        Log("====================================")
        return Counting(Formatting(text))
    }

    function Formatting(text) {
        let output = []
        let operator = []
        for (let i = 0; i < text.length; i++) {
            // Log("i now " + i)
            // Log(text.charCodeAt(i))

            //////Detecting Numeric==================================================
            if (isNumerical(text.charCodeAt(i))) {
                Log("Detecting Numerical")
                let n = text.charAt(i)
                let nResult
                for (let j = i + 1; j < text.length; j++) {
                    if (isNumerical(text.charCodeAt(j))) {
                        n += text.charAt(j)
                        // Log(j)
                    }
                    else {
                        nResult = parseInt(n)
                        break
                    }
                    i = j
                }
                if (nResult === undefined)
                    nResult = parseInt(n)
                output.push(nResult)
                Log("Numerical Detected: " + nResult)
            }
            //////Detecting Alphabet==================================================
            else if (isAlphabetic(text.charCodeAt(i))) {
                // Log("alphabet i now " + i)
                Log("Detecting Alphabet Operator")
                let n = text.charAt(i)
                let nResult

                for (let j = i + 1; j < text.length; j++) {
                    if (isAlphabetic(text.charCodeAt(j)) || text.charAt(j) == '(') {
                        n += text.charAt(j)
                    }
                    else {
                        nResult = n
                        break
                    }
                    i = j
                }
                if (nResult === undefined)
                    nResult = n

                Log("Alphabet Operator detected: " + nResult)

                // Log("nResult: " + nResult)
                if (nResult.toLowerCase() == 'sin(' || nResult.toLowerCase() == 'cos(' || nResult.toLowerCase() == 'tan(') {
                    //Belakangnya huruf atau operator
                    if (isNumerical(text.charCodeAt(i - 4))) {
                        Log("before sin/cos/tan is numerical")
                        if (isPrecedence(operator[operator.length - 1], '*')) {
                            Log(operator[operator.length - 1] + " and " + '*' + ' is precedence')
                            output.push(operator.pop())
                            operator.push('*')
                        }
                    }
                    operator.push(nResult.charAt(0).toLowerCase())
                    operator.push('(')

                } else {
                    Log("push w")
                    operator.push('w')
                }
            }
            //////Detecting Operator==================================================
            else {
                Log('Detecting Operator')
                // Log("operator i now " + i)
                if (text.charAt(i) == '(' && isNumerical(text.charCodeAt(i - 1))) {
                    // if (isPrecedence(operator[operator.length - 1], '*')) {
                    //     output.push(operator.pop())
                    // }
                    // operator.push('*')

                    while (isPrecedence(operator[operator.length - 1], '*')) {
                        output.push(operator.pop())
                    }
                    operator.push('*')
                } else if (text.charAt(i) != ')') {
                    if (isPrecedence(operator[operator.length - 1], text.charAt(i))) {
                        while (isPrecedence(operator[operator.length - 1], text.charAt(i))) {
                            Log(operator[operator.length - 1] + " and " + text.charAt(i) + " is Precedence")
                            output.push(operator.pop())
                        }
                    } else
                        Log(operator[operator.length - 1] + " and " + text.charAt(i) + " is not Precedence")
                }

                if (text.charAt(i) == ')') {
                    Log("Close Bracket ')' Detected")
                    for (let i = operator.length - 1; i >= 0; i--) {
                        if (operator[i] != '(') {
                            if (operator[i - 1] == 's' || operator[i - 1] == 'c' || operator[i - 1] == 't')
                                output.push(operator.pop())
                            output.push(operator.pop())
                        }
                        else break
                    }
                    operator.pop()
                }
                else operator.push(text.charAt(i))
            }

            Log('=>output: ' + output)
            Log('=>Operator: ' + operator)
            Log("==================")
        }
        Log('===>output: ' + output)
        Log('===>Operator: ' + operator)

        for (let i = 0; i <= operator.length + 1; i++) {
            let pop = operator.pop()
            if (pop !== undefined)
                output.push(pop)
        }
        Log("counted array:" + output)
        return output
    }

    function Counting(array) {
        if (array.length < 2) {
            return Log("Not Valid")
        } else {
            for (let i = 1; i < array.length; i++) {

                if (isOperator(array[i]) || isAlphabetic(`${array[i]}`.charCodeAt(0))) {
                    operator = array[i]
                    if (operator == 'w')
                        return "invalid"
                    switch (operator) {
                        case '+':
                            right = array[i - 1]
                            left = array[i - 2]
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);

                            Log(left + "+" + right)
                            array.splice(i - 2, 0, left + right)
                            i = 0
                            break;
                        case '-':
                            right = array[i - 1]
                            left = array[i - 2]
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);

                            Log(left + "-" + right)
                            array.splice(i - 2, 0, left - right)
                            i = 0
                            break;
                        case '*':
                            right = array[i - 1]
                            left = array[i - 2]
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);

                            Log(left + "*" + right)
                            array.splice(i - 2, 0, left * right)
                            i = 0
                            break;
                        case '/':
                            right = array[i - 1]
                            left = array[i - 2]
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);
                            array.splice(i - 2, 1);

                            Log(left + "/" + right)
                            array.splice(i - 2, 0, left / right)
                            i = 0
                            break;
                        case 's':
                            n = array[i - 1]
                            array.splice(i - 1, 1);
                            array.splice(i - 1, 1);

                            Log("Sin(" + n + ")")
                            array.splice(i - 1, 0, Math.sin(n * Math.PI / 180))
                            i = 0
                            break;
                        case 'c':
                            n = array[i - 1]
                            array.splice(i - 1, 1);
                            array.splice(i - 1, 1);

                            Log("Cos(" + n + ")")
                            array.splice(i - 1, 0, Math.cos(n * Math.PI / 180))
                            i = 0
                            break;
                        case 't':
                            n = array[i - 1]
                            array.splice(i - 1, 1);
                            array.splice(i - 1, 1);

                            Log("Tan(" + n + ")")
                            array.splice(i - 1, 0, Math.tan(n * Math.PI / 180))
                            i = 0
                            break;
                        default:
                            break;
                    }

                    Log('counted array:' + array)
                }
            }
            Log(array)
        }
        if (array.length > 1)
            return "Invalid"
        return array.pop()
    }
</script>

</html>